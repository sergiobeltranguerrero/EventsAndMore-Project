{% extends "home_base.html" %}

{% block title %} Visualizar Incidencias {% endblock %}

{% block body %}


<div class="container">
    <h1>Lista de incidencias</h1>
    <form action="" method="POST">
        {% csrf_token %}
        <select class="form-select" id="state" name="state" aria-label="Default select example">
            <option value="%"
            {% if selection == '%' %}
                selected
            {% endif %}
            >Seleccionar...</option>
            {% for state in states %}
            <option value="{{ state.id }}"
            {% if selection == state.id %}
                selected
            {% endif %}
            >{{ state.name }}</option>
            {% endfor %}
        </select>
        <div class="input-group">
            <button class="btn  btn-secondary" type="submit" id="filter">Filtrar</button>
        </div>
    </form>

    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
        <div clas="table-responsive py-2 ">
            <table class="table table-striped text-truncate">
                <thead>
                <tr>

                    {% if user.is_servicios_adicionales %}
                        <th colspan="2">Cliente</th>
                    {% endif %}
                    <th>Titulo incidencia</th>
                    <th>Descripcion</th>
                    <th>Evento</th>
                    <th>Estado de la solicitud</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% if incidencia|length != 0 %}
                {% for inciden in  incidencia%}
                <tr class="
                    {% if inciden.estadoIn == 'SC' %}
                        table-success
                    {% elif inciden.estadoIn == 'PD' %}
                        table-warning
                    {% elif inciden.estadoIn == 'EP' %}
                        table-info
                    {% else %}
                        table-danger
                    {% endif%}
                    ">

                    <th scope="row" hidden><input type="number" id="id_incidencia{{inciden.id}}" name="id_assignacion{{inciden.id}}" value="{{inciden.id}}" readonly required/></th>
                    {% if user.is_servicios_adicionales %}
                        <td>{{inciden.cliente.user.first_name}}</td>
                        <td>{{inciden.cliente.user.last_name}}</td>
                    {% endif %}
                    <td>{{inciden.nombre}}</td>
                    <td>{{inciden.descripcion}}</td>
                    <td>{{inciden.evento.nombre}}</td>

                    <td>
                            <h4>
                                <span class="badge badge-pill
                        {% if inciden.estadoIn == 'PD' %}
                            bg-warning">{{'Incidencia pendiente'}}
                        {% elif inciden.estadoIn == 'SC' %}
                            bg-success">{{'Incidencia solucionada'}}
                        {% elif inciden.estadoIn == 'EP' %}
                            bg-info">{{'Incidencia en progreso'}}
                        {% else %}
                            bg-danger">Error en la solicitud
                        {% endif%}
                                </span>
                            </h4>
                        </td>
                        <td>
                            <div class="form-group">
                                {% if  user.is_cliente %}
                                    {% if not inciden.estadoIn == 'PD'  %}
                                        <a class="btn btn-primary btn-block" href="{% url 'detalles_incidencia' inciden.id %}" >Detalles</a>
                                    {% else %}
                                        <a class="btn btn-danger btn-block text-white disabled " href=# >Cerrada</a>
                                    {% endif %}
                                {% elif user.is_servicios_adicionales %}
                                    <a class="btn btn-primary btn-block text-white text-truncate" href="{% url 'valorar_incidencia' inciden.id %}" >Valorar incidencia</a>
                                {% endif %}
                            </div>
                        </td>
                </tr>
                {% endfor %}
                {% endif %}
                </tbody>
            </table>
            <a class="btn btn-success" href="{% url 'nueva_incidencia' %}">Crear nueva incidencias</a>
        </div>
    </div>
</div>

{% endblock %}

